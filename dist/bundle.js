(()=>{"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var i=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=i){var r,n,o,a,u=[],s=!0,l=!1;try{if(o=(i=i.call(t)).next,0===e){if(Object(i)!==i)return;s=!1}else for(;!(s=(r=o.call(i)).done)&&(u.push(r.value),u.length!==e);s=!0);}catch(t){l=!0,n=t}finally{try{if(!s&&null!=i.return&&(a=i.return(),Object(a)!==a))return}finally{if(l)throw n}}return u}}(t,e)||i(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){if(t){if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function n(e,i){for(var r=0;r<i.length;r++){var n=i[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,i){if("object"!==t(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==t(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===t(o)?o:String(o)),n)}var o}var o=function(){function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.individuals=[],this.individualCount=e,this.individualSize=i,this.averageFitness=0,this.IndividualClass=r}var o,a;return o=t,(a=[{key:"spawn",value:function(){for(var t=0;t<this.individualCount;t++){var e=new this.IndividualClass(this.individualSize);e.random(),this.individuals[t]=e}return this.individuals}},{key:"pick",value:function(){for(var t=Math.random(),e=0;e<this.individualCount;e++)if(this.individuals[e].probability>t)return this.individuals[e]}},{key:"select",value:function(t){var e=[],i=this.individuals.reduce((function(t,e){return t+e.fitness}),0);this.individuals.forEach((function(t){t.probability=i/t.fitness}));var r=this.individuals.reduce((function(t,e){return t+e.probability}),0);this.individuals.forEach((function(t){t.probability/=r}));var n,o,a=0;this.individuals.forEach((function(t){a+=t.probability,t.probability=a}));for(var u=0;u<t;u++){for(o=n=this.pick();n===o;)o=this.pick();e.push([n,o])}return e}},{key:"crossover",value:function(){for(var t=[],i=this.select(Math.ceil(this.individualCount/2)),r=0;r<i.length;r++){var n=new this.IndividualClass(this.individualSize),o=new this.IndividualClass(this.individualSize),a=e(i[r],2),u=a[0],s=a[1],l=e(u.crossover(s),2);n.genes=l[0],o.genes=l[1],t.push(n,o)}return t}},{key:"generate",value:function(){var t;this.evaluate();var e,n=this.crossover();return(t=this.individuals).push.apply(t,function(t){if(Array.isArray(t))return r(t)}(e=n)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||i(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),this.evaluate(),this.cull(),this.mutate(),this.individuals}}])&&n(o.prototype,a),Object.defineProperty(o,"prototype",{writable:!1}),t}();function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function u(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==a(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===a(n)?n:String(n)),r)}var n}function s(t,e,i){return e&&u(t.prototype,e),i&&u(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function c(t){return function(t){if(Array.isArray(t))return f(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?f(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function y(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==l(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===l(n)?n:String(n)),r)}var n}function h(t,e){return h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},h(t,e)}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}var d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(a,t);var e,i,r,n,o=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=v(r);if(n){var i=v(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===l(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.apply(this,arguments)}return e=a,(i=[{key:"random",value:function(){for(var t=[],e=0;e<this.size;e++)t.push(e);for(var i=0;i<this.size;i++)this.genes[i]=t.splice(Math.floor(Math.random()*t.length),1)[0]}},{key:"crossover",value:function(t){var e=[],i=[],r=Math.min(this.size-2,Math.max(Math.floor(Math.random()*this.size),1)),n=this.genes.slice(0,r);return e.push.apply(e,c(n)),e.push.apply(e,c(t.genes.filter((function(t){return!n.includes(t)})))),i.push.apply(i,c(t.genes.filter((function(t){return n.includes(t)})))),i.push.apply(i,c(this.genes.slice(r,this.size))),[e,i]}}])&&y(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(s((function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.size=e,this.genes=[]})));function p(t){return p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},p(t)}function b(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==p(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==p(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===p(n)?n:String(n)),r)}var n}function m(t,e){return m=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},m(t,e)}function g(t){return g=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},g(t)}var S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&m(t,e)}(a,t);var e,i,r,n,o=(r=a,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=g(r);if(n){var i=g(this).constructor;t=Reflect.construct(e,arguments,i)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===p(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function a(t,e){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(i=o.call(this,t,e.length,d)).cities=e,i}return e=a,(i=[{key:"getDistance",value:function(t,e){var i=this.cities[t],r=this.cities[e];return Math.hypot(r[0]-i[0],r[1]-i[1])}},{key:"evaluate",value:function(){this.averageFitness=0;for(var t=0;t<this.individuals.length;t++){this.individuals[t].fitness=0;for(var e=0;e<this.individualSize-1;e++)this.individuals[t].fitness+=this.getDistance(this.individuals[t].genes[e],this.individuals[t].genes[e+1]);this.individuals[t].fitness+=this.getDistance(this.individuals[t].genes[0],this.individuals[t].genes[this.individualSize-1]),this.averageFitness+=this.individuals[t].fitness}return this.averageFitness/=this.individuals.length,this.individuals}},{key:"cull",value:function(){this.individuals.sort((function(t,e){return e.fitness-t.fitness})),this.individuals.splice(0,this.individualCount)}},{key:"mutate",value:function(){for(var t=0;t<this.individualCount;t++)if(Math.random()<.1){for(var e=[Math.floor(Math.random()*this.individualSize),Math.floor(Math.random()*this.individualSize)],i=e[0],r=e[1];i==r;)r=Math.floor(Math.random()*this.individualSize);var n=[this.individuals[t][r],this.individuals[t][i]];this.individuals[t][i]=n[0],this.individuals[t][r]=n[1]}return this.individuals}}])&&b(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(o);function w(t){return w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},w(t)}function j(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==w(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==w(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===w(n)?n:String(n)),r)}var n}var k=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.canvasW=this.canvas.width,this.canvasH=this.canvas.height,this.cityRadius=5,this.cityFill="white",this.cityStroke="white",this.geneStroke="rgba(125,180,255,0.1)",this.fittestStroke="blue",this.strokeStyle=this.geneStroke,this.lineWidth=1}var e,i;return e=t,(i=[{key:"clear",value:function(){this.ctx.clearRect(0,0,this.canvasW,this.canvasH)}},{key:"drawLine",value:function(t,e,i,r){this.ctx.moveTo(t,e),this.ctx.lineTo(i,r)}},{key:"drawCircle",value:function(t,e,i){this.ctx.moveTo(t+i,e),this.ctx.arc(t,e,i,0,2*Math.PI)}},{key:"drawFittest",value:function(t){this.lineWidth=5,this.strokeStyle=this.fittestStroke,this.drawGenes(t),this.strokeStyle=this.geneStroke,this.lineWidth=1}},{key:"drawGenes",value:function(t){this.ctx.strokeStyle=this.strokeStyle,this.ctx.lineWidth=this.lineWidth,this.ctx.beginPath();for(var e=0;e<t.length;e++)this.drawLine(t[e][0],t[e][1],t[e][2],t[e][3]);this.ctx.stroke()}},{key:"drawCities",value:function(t){this.ctx.fillStyle=this.cityFill,this.ctx.strokeStyle=this.cityStroke,this.ctx.lineWidth=this.lineWidth,this.ctx.beginPath();for(var e=0;e<t.length;e++)this.drawCircle(t[e][0],t[e][1],this.cityRadius);this.ctx.fill(),this.ctx.stroke()}}])&&j(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();function O(t){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},O(t)}function P(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return C(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?C(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,r=new Array(e);i<e;i++)r[i]=t[i];return r}function A(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(void 0,n=function(t,e){if("object"!==O(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(r.key),"symbol"===O(n)?n:String(n)),r)}var n}new(function(){function t(e,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.renderer=new k(e),this.cityCount=i}var e,i;return e=t,(i=[{key:"init",value:function(){this.createCities(),this.createPopulation()}},{key:"createCities",value:function(){this.cities=[];for(var t=0;t<this.cityCount;t++)this.cities.push([Math.floor(Math.random()*this.renderer.canvas.width),Math.floor(Math.random()*this.renderer.canvas.height)])}},{key:"createPopulation",value:function(){this.population=new S(750,this.cities),this.population.spawn()}},{key:"individualToCityArray",value:function(t){for(var e=[],i=1;i<t.size;i++)e.push([].concat(P(this.cities[t.genes[i]]),P(this.cities[t.genes[i-1]])));return e.push([].concat(P(this.cities[t.genes[0]]),P(this.cities[t.genes[t.size-1]]))),e}},{key:"update",value:function(){console.log(this.population),this.population.generate(),this.renderer.clear();for(var t=[],e=0;e<this.population.individualCount;e++){var i=this.population.individuals[e];t.push.apply(t,P(this.individualToCityArray(i)))}this.renderer.drawGenes(t);var r=this.population.individuals.sort((function(t,e){return e.fitness-t.fitness}))[0],n=this.individualToCityArray(r);this.renderer.drawFittest(n),this.renderer.drawCities(this.cities)}},{key:"run",value:function(){var t=this;this.init(),window.setInterval((function(e){return t.update()}),250)}}])&&A(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}())("canvas",20).run()})();